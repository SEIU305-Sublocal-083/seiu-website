<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <!-- Anti-FOUC (Flash of Unstyled Content) Fix -->
    <style id="anti-fouc">html{visibility:hidden;opacity:0;}</style>
    <script>
    (function(){
      var s = document.getElementById('anti-fouc');
      var r = function(){
        if(s){
          s.remove();
          document.documentElement.style.visibility='visible';
          document.documentElement.style.opacity='1';
        }
      };
      // Safety timeout in case of script error or slow load
      setTimeout(r, 1500);

      // Wait for DOMContentLoaded, then give a small buffer for Tailwind to parse
      document.addEventListener('DOMContentLoaded', function(){
        setTimeout(r, 100);
      });
    })();
    </script>
    <noscript>
      <style>html{visibility:visible!important;opacity:1!important;}</style>
    </noscript>
    <!-- End Anti-FOUC Fix -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Find upcoming events, meetings, and trainings for SEIU Local 503 at Oregon State University.">
    <meta name="author" content="SEIU Local 503 at OSU">
    <title>Events - SEIU Local 503, OSU</title>
    <link rel="icon" href="/images/logo.png" type="image/png">
    <link rel="apple-touch-icon" href="/images/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-purple-dark': '#4C1D95',
                        'brand-purple': '#7C3AED',
                        'brand-purple-light': '#EDE9FE',
                        'brand-dark': '#111827',
                        'brand-light': '#F9FAFB',
                        'text-primary': '#1F2937',
                        'text-secondary': '#374151',
                        'border-color': '#D1D5DB',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Lora', 'serif'],
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Lora:wght@400;500;700&display=swap" rel="stylesheet">
    <style type="text/tailwindcss">
        html {
            scroll-padding-top: 80px; /* Offset for sticky header */
        }

        body {
            font-family: 'Inter', sans-serif;
            @apply bg-brand-light text-text-primary antialiased;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Lora', serif;
            @apply text-brand-purple-dark;
        }

        /* Accessibility: Clear focus indicators for all interactive elements */
        a:focus-visible, button:focus-visible, details:focus-visible, input:focus-visible, textarea:focus-visible, [tabindex="0"]:focus-visible {
            outline: 3px solid var(--brand-purple);
            outline-offset: 2px;
            border-radius: 4px;
        }
        
        .btn {
            @apply font-bold py-3 px-6 rounded-lg transition-all duration-300 ease-in-out transform hover:scale-105 inline-flex items-center justify-center;
        }
        .btn-primary {
            @apply bg-gradient-to-r from-brand-purple to-violet-600 text-white shadow-md hover:shadow-lg hover:to-brand-purple;
        }
        .btn-secondary {
            @apply bg-brand-dark text-white hover:bg-black;
        }
        .btn-outline {
             @apply bg-white text-brand-purple border-2 border-brand-purple hover:bg-brand-purple hover:text-white;
        }
        
        /* Calendar Styles */
        .calendar-day.has-event {
            @apply bg-purple-100 text-brand-purple font-bold relative;
        }
        .calendar-day.has-event::after {
            content: '';
            @apply absolute bottom-1 left-1/2 transform -translate-x-1/2 w-1.5 h-1.5 bg-brand-purple rounded-full;
        }
        .calendar-day.is-today {
            @apply bg-brand-purple text-white shadow-md;
        }
        .calendar-day.is-today::after {
            @apply bg-white;
        }
        .calendar-day.has-event:hover {
            @apply bg-purple-200 cursor-pointer;
        }

        /* Timeline Styles */
        .timeline-line {
            @apply absolute left-8 top-0 bottom-0 w-0.5 bg-gray-200 md:left-1/2 md:-ml-px;
        }
        /* Adjusted for single column timeline on right */
        .timeline-container-single .timeline-line {
            @apply left-9 top-6 bottom-0 w-0.5 bg-gray-200 md:left-9;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            @apply bg-gray-100;
        }
        ::-webkit-scrollbar-thumb {
            @apply bg-gray-300 rounded hover:bg-gray-400;
        }
    </style>
</head>
<body class="bg-brand-light">

    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-lg border-b border-border-color sticky top-0 z-50 transition-all duration-300">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="/index.html" class="flex items-center space-x-2 group">
                <span class="text-2xl font-bold text-brand-purple-dark group-hover:text-brand-purple transition-colors">SEIU 503</span>
                <span class="text-lg text-text-secondary hidden md:block">| Oregon State University</span>
            </a>
            <div class="hidden lg:flex space-x-8 font-medium" id="desktop-nav">
                <a href="/about.html" class="text-text-secondary hover:text-brand-purple transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-brand-purple after:transition-all hover:after:w-full">About</a>
                <a href="/events.html" class="text-text-secondary hover:text-brand-purple transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-brand-purple after:transition-all hover:after:w-full">Events</a>
                <a href="/news.html" class="text-text-secondary hover:text-brand-purple transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-brand-purple after:transition-all hover:after:w-full">News</a>
                <a href="/resources.html" class="text-text-secondary hover:text-brand-purple transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-brand-purple after:transition-all hover:after:w-full">Resources & Rights</a>
                <a href="/leadership.html" class="text-text-secondary hover:text-brand-purple transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-brand-purple after:transition-all hover:after:w-full">Leadership</a>
                <a href="/contact.html" class="text-text-secondary hover:text-brand-purple transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-brand-purple after:transition-all hover:after:w-full">Contact</a>
            </div>
            <div class="lg:hidden">
                <button id="mobile-menu-button" class="text-text-secondary hover:text-brand-purple focus:outline-none p-2 rounded-md hover:bg-gray-100" aria-label="Open menu">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </nav>
        <div id="mobile-menu" class="hidden lg:hidden absolute top-full left-0 w-full bg-white border-t border-border-color shadow-lg">
            <a href="/about.html" class="block text-center py-4 px-6 text-lg text-text-secondary hover:bg-gray-50 hover:text-brand-purple border-b border-gray-100">About</a>
            <a href="/events.html" class="block text-center py-4 px-6 text-lg text-text-secondary hover:bg-gray-50 hover:text-brand-purple border-b border-gray-100">Events</a>
            <a href="/news.html" class="block text-center py-4 px-6 text-lg text-text-secondary hover:bg-gray-50 hover:text-brand-purple border-b border-gray-100">News</a>
            <a href="/resources.html" class="block text-center py-4 px-6 text-lg text-text-secondary hover:bg-gray-50 hover:text-brand-purple border-b border-gray-100">Resources & Rights</a>
            <a href="/leadership.html" class="block text-center py-4 px-6 text-lg text-text-secondary hover:bg-gray-50 hover:text-brand-purple border-b border-gray-100">Leadership</a>
            <a href="/contact.html" class="block text-center py-4 px-6 text-lg text-text-secondary hover:bg-gray-50 hover:text-brand-purple">Contact</a>
        </div>

        <script>
            // --- Header Logic: Mobile Menu & Active State ---
            document.addEventListener('DOMContentLoaded', () => {
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');
                const navLinks = document.querySelectorAll('#mobile-menu a');

                // Mobile Menu Toggle
                if (mobileMenuButton && mobileMenu) {
                    mobileMenuButton.addEventListener('click', () => {
                        const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
                        mobileMenuButton.setAttribute('aria-expanded', !isExpanded);
                        mobileMenu.classList.toggle('hidden');
                    });

                    navLinks.forEach(link => {
                        link.addEventListener('click', () => {
                            mobileMenu.classList.add('hidden');
                            mobileMenuButton.setAttribute('aria-expanded', 'false');
                        });
                    });
                }

                // Active State Highlighting
                const currentPath = window.location.pathname;
                const filename = currentPath.split('/').pop() || 'index.html';

                // Selector for both desktop and mobile links
                const allNavLinks = document.querySelectorAll('#desktop-nav a, #mobile-menu a');

                allNavLinks.forEach(link => {
                    const href = link.getAttribute('href');
                    // Simple check: if href matches filename (e.g. 'news.html')
                    // Logic handles root '/' mapping to 'index.html' implicitly via filename check above
                    if (href && (href === filename || href === '/' + filename || (filename === 'index.html' && (href === './' || href === '/')))) {

                        // Apply Active Styles
                        link.classList.add('text-brand-purple', 'font-bold');
                        link.classList.remove('text-text-secondary');

                        // Specific styling adjustments for Mobile vs Desktop if needed
                        if (link.closest('#mobile-menu')) {
                             link.classList.add('bg-brand-purple-light/30');
                        }
                    }
                });
            });
        </script>
    </header>

    <!-- Distinct Hero: Simpler, Pattern-based -->
    <section class="relative bg-brand-dark text-white overflow-hidden">
        <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(#4C1D95 1px, transparent 1px); background-size: 20px 20px;"></div>
        <div class="container mx-auto px-6 py-16 flex flex-col md:flex-row items-center justify-between relative z-10">
            <div>
                <h1 class="text-4xl md:text-5xl font-bold mb-4 tracking-tight">Calendar</h1>
                <p class="text-lg text-gray-300 max-w-xl">Stay connected with your union. Filter events by type to find exactly what you're looking for.</p>
            </div>
            <!-- Category Filters in Hero -->
            <div class="mt-8 md:mt-0 flex flex-wrap gap-3">
                <button class="filter-btn active px-4 py-2 rounded-full border border-gray-600 bg-white text-brand-dark font-semibold text-sm transition-all hover:bg-gray-100" data-filter="all">All Events</button>
                <button class="filter-btn px-4 py-2 rounded-full border border-gray-600 bg-transparent text-gray-300 font-semibold text-sm transition-all hover:bg-gray-800 hover:text-white" data-filter="meeting">Meetings</button>
                <button class="filter-btn px-4 py-2 rounded-full border border-gray-600 bg-transparent text-gray-300 font-semibold text-sm transition-all hover:bg-gray-800 hover:text-white" data-filter="social">Social</button>
                <button class="filter-btn px-4 py-2 rounded-full border border-gray-600 bg-transparent text-gray-300 font-semibold text-sm transition-all hover:bg-gray-800 hover:text-white" data-filter="action">Action</button>
            </div>
        </div>
    </section>

    <main class="container mx-auto px-6 py-12">
        <div class="grid lg:grid-cols-12 gap-12">

            <!-- Sidebar: Calendar (Sticky) -->
            <aside class="lg:col-span-4 xl:col-span-3">
                <div class="bg-white p-6 rounded-2xl border border-border-color shadow-lg sticky top-28">
                    <div id="calendar-container">
                        <!-- Calendar injected by JS -->
                        <div class="animate-pulse space-y-4">
                            <div class="h-8 bg-gray-200 rounded w-1/2 mx-auto"></div>
                            <div class="grid grid-cols-7 gap-2">
                                <div class="h-8 bg-gray-200 rounded-full"></div>
                                <div class="h-8 bg-gray-200 rounded-full"></div>
                                <div class="h-8 bg-gray-200 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 pt-6 border-t border-gray-100">
                        <h4 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3">Key</h4>
                        <div class="flex items-center gap-4 text-sm">
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 bg-brand-purple rounded-full"></span> Today
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 bg-purple-100 rounded-full border border-purple-200 relative"><span class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 bg-brand-purple rounded-full"></span></span> Event
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content: Vertical Timeline -->
            <section class="lg:col-span-8 xl:col-span-9 relative timeline-container-single">
                <div class="timeline-line"></div>

                <div id="timeline-events" class="space-y-4">
                    <!-- Timeline items injected by JS -->
                </div>

                <div id="no-events-message" class="hidden text-center py-12 bg-white rounded-xl border border-dashed border-gray-300 ml-12">
                    <p class="text-text-secondary font-medium">No events found for this category.</p>
                    <button id="reset-filters" class="mt-2 text-brand-purple font-bold hover:underline">Show All Events</button>
                </div>
                
                <!-- Past Events Toggle -->
                <div class="mt-16 ml-12">
                    <button id="toggle-past-events" class="flex items-center gap-2 text-gray-500 font-semibold hover:text-brand-purple transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        View Past Events
                    </button>
                    <div id="past-events-wrapper" class="hidden mt-8 space-y-6 border-l-2 border-gray-200 pl-6 border-dashed">
                        <!-- Past events injected here -->
                    </div>
                </div>
            </section>
        </div>
    </main>

        <footer class="bg-brand-dark text-white pt-12 pb-8">
        <div class="container mx-auto px-6">
            <div class="mt-10 pt-8 border-t border-gray-700 text-center">
            </div>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Column 1: About the Union -->
                <div class="md:col-span-2 lg:col-span-1">
                    <div class="flex items-center mb-4">
                        <img src="/images/logo.png" alt="SEIU 503 Logo" class="h-12 w-12 mr-3 bg-white p-1 rounded">
                        <div>
                            <h3 class="text-xl font-bold">SEIU Local 503</h3>
                            <p class="text-gray-400 text-sm">Oregon State University</p>
                        </div>
                    </div>
                    <p class="text-black leading-relaxed">Representing the classified employees of Oregon State University. We fight for fair contracts, defend workplace rights, and build a united community.</p>
                </div>
    
                <!-- Column 2: Quick Links -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 tracking-wider uppercase">Quick Links</h4>
                    <ul class="space-y-3">
                        <li><a href="/about.html" class="text-black hover:text-gray-500 transition-colors">About Us</a></li>
                        <li><a href="/events.html" class="text-black hover:text-gray-500 transition-colors">Events</a></li>
                        <li><a href="/news.html" class="text-black hover:text-gray-500 transition-colors">News</a></li>
                        <li><a href="/leadership.html" class="text-black hover:text-gray-500 transition-colors">Leadership</a></li>
                    </ul>
                </div>
    
                <!-- Column 3: Resources -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 tracking-wider uppercase"><a href="/resources.html" class="hover:text-gray-500 transition-colors">Resources</a></h4>
                    <ul class="space-y-3">
                        <li><a href="/resources.html" class="text-black hover:text-gray-500 transition-colors">Resources & Rights</a></li>
                        <li><a href="/resources/seiu_cba_2022-2026.pdf" class="text-black hover:text-gray-500 transition-colors">Our Contract (PDF)</a></li>
                        <li><a href="/resources/stewards.html" class="text-black hover:text-gray-500 transition-colors">Find a Steward</a></li>
                        <li><a href="/resources/weingarten-rights.html" class="text-black hover:text-gray-500 transition-colors">Weingarten Rights</a></li>
                    </ul>
                </div>
    
                <!-- Column 4: Contact -->
                <div>
                    <h4 class="text-lg font-semibold mb-4 tracking-wider uppercase"><a href="/contact.html" class="hover:text-gray-500 transition-colors">Contact Us</a></h4>
                     <ul class="space-y-3 text-black">
                        <li class="flex items-start">
                            <span class="mr-2 mt-1">✉️</span> <!-- Mail icon -->
                            <a href="mailto:083execteam@seiu503.org" class="hover:text-gray-500 transition-colors">083execteam@seiu503.org</a>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 mt-1">✉️</span> <!-- Mail icon -->
                            <a href="mailto:083stewards@seiu503.org" class="hover:text-gray-500 transition-colors">083stewards@seiu503.org</a>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 mt-1">&#128205;</span> <!-- Pin icon -->
                            <a href="https://maps.app.goo.gl/9TWRZ9F4wjVjacsZ7" class="hover:text-gray-500 transition-colors">Adams Hall, Room 109<br>Corvallis, OR 97331</a>
                        </li>
                    </ul>
                </div>
            </div>
    
            <!-- Bottom Bar -->
            <div class="mt-10 pt-8 border-t border-gray-700 text-center">
                <p class="text-gray-400 text-sm">&copy; 2025 SEIU Local 503, Oregon State University. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Global Variables ---
            const calendarContainer = document.getElementById('calendar-container');
            const timelineContainer = document.getElementById('timeline-events');
            const pastEventsWrapper = document.getElementById('past-events-wrapper');
            const togglePastBtn = document.getElementById('toggle-past-events');
            const filterBtns = document.querySelectorAll('.filter-btn');
            const noEventsMsg = document.getElementById('no-events-message');

            let currentDate = new Date();
            let eventsForCalendar = {};
            let allEventsData = [];
            let activeFilter = 'all';

            // --- Main Function to Load Event Data ---
            async function loadEvents() {
                try {
                    const response = await fetch('events/events.json');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    allEventsData = await response.json();

                    // Initial Render
                    renderEvents();

                    // Generate Calendar
                    eventsForCalendar = createCalendarEventObject(allEventsData);
                    generateCalendar(currentDate.getMonth(), currentDate.getFullYear());
                } catch (error) {
                    console.error('Error fetching events:', error);
                    timelineContainer.innerHTML = `
                        <div class="ml-12 p-6 bg-red-50 text-red-600 rounded-lg border border-red-200">
                            Failed to load events. Please refresh the page.
                        </div>`;
                }
            }

            // --- Categorization Helper ---
            function getCategory(event) {
                const type = (event.type || "").toLowerCase();
                const title = (event.title || "").toLowerCase();

                if (type.includes('zoom') || type.includes('meeting') || title.includes('meeting')) return 'meeting';
                if (type.includes('social') || type.includes('bowling') || type.includes('picnic')) return 'social';
                if (type.includes('action') || type.includes('rally') || type.includes('volunteer')) return 'action';
                return 'other';
            }

            // --- Rendering Logic ---
            function renderEvents() {
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                // Filter by category
                let filtered = allEventsData;
                if (activeFilter !== 'all') {
                    filtered = allEventsData.filter(e => {
                        const cat = getCategory(e);
                        // Simple mapping: 'other' shows in all for now, or just stick to strict types
                        return cat === activeFilter;
                    });
                }

                // Split Upcoming / Past
                const upcoming = filtered
                    .filter(event => new Date(event.date.replace(/-/g, '\/')) >= today)
                    .sort((a, b) => new Date(a.date.replace(/-/g, '\/')) - new Date(b.date.replace(/-/g, '\/')));

                const past = filtered
                    .filter(event => new Date(event.date.replace(/-/g, '\/')) < today)
                    .sort((a, b) => new Date(b.date.replace(/-/g, '\/')) - new Date(a.date.replace(/-/g, '\/')));

                // Render Timeline
                timelineContainer.innerHTML = '';
                if (upcoming.length === 0) {
                    noEventsMsg.classList.remove('hidden');
                } else {
                    noEventsMsg.classList.add('hidden');
                    upcoming.forEach(event => {
                        timelineContainer.appendChild(createTimelineItem(event));
                    });
                }

                // Render Past (Simple List)
                pastEventsWrapper.innerHTML = '';
                past.forEach(event => {
                    const el = document.createElement('div');
                    const d = new Date(event.date.replace(/-/g, '\/'));
                    el.className = 'text-sm text-gray-500';
                    el.innerHTML = `<span class="font-bold mr-2">${d.toLocaleDateString()}</span> <a href="${event.url}" class="hover:text-brand-purple hover:underline transition-colors">${event.title}</a>`;
                    pastEventsWrapper.appendChild(el);
                });
            }

            // --- ACCORDION ITEM CREATION ---
            function createTimelineItem(event) {
                const date = new Date(event.date.replace(/-/g, '\/'));
                const month = date.toLocaleString('en-US', { month: 'short' }).toUpperCase();
                const day = date.getDate();
                const weekday = date.toLocaleString('en-US', { weekday: 'long' });

                const item = document.createElement('div');
                item.className = 'relative pl-12 md:pl-20 py-2 group';
                item.id = `event-${event.date}`; // Anchor for linking

                // HTML Structure for Accordion
                item.innerHTML = `
                    <!-- Timeline Dot/Date Bubble -->
                    <div class="absolute left-0 top-2 w-[70px] flex flex-col items-center justify-center bg-white border-2 border-brand-purple rounded-xl py-2 z-10 shadow-sm transition-transform group-hover:scale-105 group-hover:bg-brand-purple group-hover:text-white group-hover:border-transparent">
                        <span class="text-xs font-bold uppercase tracking-wider text-brand-purple-dark group-hover:text-purple-100">${month}</span>
                        <span class="text-2xl font-bold leading-none text-brand-dark group-hover:text-white">${day}</span>
                    </div>

                    <!-- Event Card (Clickable Accordion) -->
                    <details class="bg-white border border-border-color rounded-xl shadow-sm hover:shadow-md transition-shadow relative open:ring-2 open:ring-brand-purple/20">
                         <!-- Arrow pointing left (Timeline connection) -->
                        <div class="absolute top-6 -left-2 w-4 h-4 bg-white border-l border-b border-border-color transform rotate-45 z-0"></div>

                        <summary class="list-none cursor-pointer p-5 flex items-center justify-between group/summary select-none relative z-10 bg-white rounded-xl">
                            <div class="flex-grow pr-4">
                                <h3 class="text-lg md:text-xl font-bold text-brand-dark font-serif group-hover/summary:text-brand-purple transition-colors">
                                    ${event.title}
                                </h3>
                                <div class="flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-text-secondary mt-1">
                                    <span class="flex items-center"><svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> ${weekday}</span>
                                    ${event.time ? `<span class="flex items-center"><svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> ${event.time}</span>` : ''}
                                    ${event.type ? `<span class="bg-gray-100 text-gray-600 px-2 py-0.5 rounded text-xs uppercase font-bold tracking-wide">${event.type}</span>` : ''}
                                </div>
                            </div>
                            <div class="flex-shrink-0 text-gray-400 transform transition-transform duration-200 group-open/summary:rotate-180">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                        </summary>

                        <div class="px-5 pb-5 pt-0 border-t border-gray-100 mt-2 bg-white rounded-b-xl">
                            <p class="text-gray-600 mt-4 leading-relaxed">${event.description}</p>

                            ${event.location_detail ? `<div class="mt-3 flex items-start text-sm text-text-secondary"><svg class="w-4 h-4 mr-2 mt-0.5 text-brand-purple flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>${event.location_detail}</div>` : ''}

                            <div class="flex items-center gap-3 mt-6">
                                <a href="${event.url}" class="btn btn-primary !py-2 !px-4 text-sm shadow-sm">View Details</a>
                                ${event.calendar_link ? `<a href="${event.calendar_link}" class="btn btn-outline !py-2 !px-4 text-sm flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> Add to Calendar</a>` : ''}
                            </div>
                        </div>
                    </details>
                `;
                return item;
            }

            // --- Calendar Logic ---
            function createCalendarEventObject(events) {
                return events.reduce((acc, event) => {
                    const date = new Date(event.date.replace(/-/g, '\/'));
                    const month = date.getMonth();
                    const day = date.getDate();
                    if (!acc[month]) acc[month] = [];
                    if (!acc[month].includes(day)) acc[month].push(day);
                    return acc;
                }, {});
            }

            function generateCalendar(month, year) {
                if (!calendarContainer) return;
                calendarContainer.innerHTML = '';
                const today = new Date();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();

                const monthName = firstDay.toLocaleString('default', { month: 'long' });

                let html = `
                    <div class="text-center select-none">
                        <div class="flex justify-between items-center mb-4">
                            <button id="prev-month" class="p-1 rounded-full hover:bg-gray-100 text-brand-purple"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                            <h3 class="text-lg font-bold text-brand-dark">${monthName} ${year}</h3>
                            <button id="next-month" class="p-1 rounded-full hover:bg-gray-100 text-brand-purple"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                        </div>
                        <div class="grid grid-cols-7 gap-1 text-center text-xs text-gray-400 font-bold mb-2">
                            <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
                        </div>
                        <div class="grid grid-cols-7 gap-1">`;
                
                for (let i = 0; i < startingDay; i++) html += `<div></div>`;

                for (let i = 1; i <= daysInMonth; i++) {
                    let dayClasses = 'calendar-day w-8 h-8 mx-auto flex items-center justify-center rounded-full text-sm transition-all duration-200 relative';
                    let dayAttributes = '';
                    const isToday = (i === today.getDate() && month === today.getMonth() && year === today.getFullYear());
                    const hasEvent = (eventsForCalendar[month] && eventsForCalendar[month].includes(i));

                    if (isToday) {
                        dayClasses += ' is-today font-bold';
                    } else if (hasEvent) {
                         dayClasses += ' has-event';
                         const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                         dayAttributes = `data-date="${dateStr}" role="button"`;
                    } else {
                        dayClasses += ' text-gray-600 hover:bg-gray-100';
                    }
                    html += `<div class="${dayClasses}" ${dayAttributes}>${i}</div>`;
                }

                html += `</div></div>`;
                calendarContainer.innerHTML = html;

                // Re-bind listeners
                document.getElementById('prev-month').addEventListener('click', () => {
                    currentDate.setMonth(currentDate.getMonth() - 1);
                    generateCalendar(currentDate.getMonth(), currentDate.getFullYear());
                });
                document.getElementById('next-month').addEventListener('click', () => {
                    currentDate.setMonth(currentDate.getMonth() + 1);
                    generateCalendar(currentDate.getMonth(), currentDate.getFullYear());
                });

                // Calendar click to scroll
                calendarContainer.querySelectorAll('.has-event').forEach(el => {
                    el.addEventListener('click', () => {
                        const dateStr = el.dataset.date;
                        const target = document.getElementById(`event-${dateStr}`);
                        if (target) {
                            target.scrollIntoView({ behavior: 'smooth', block: 'center' });

                            // Open details if using accordion
                            const details = target.querySelector('details');
                            if(details) details.open = true;

                            target.classList.add('ring-2', 'ring-brand-purple', 'ring-offset-2');
                            setTimeout(() => target.classList.remove('ring-2', 'ring-brand-purple', 'ring-offset-2'), 2000);
                        }
                    });
                });
            }

            // --- Event Listeners ---
            // Filter Buttons
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // UI Update
                    filterBtns.forEach(b => {
                        b.classList.remove('active', 'bg-white', 'text-brand-dark', 'border-white');
                        b.classList.add('bg-transparent', 'text-gray-300', 'border-gray-600');
                    });
                    btn.classList.remove('bg-transparent', 'text-gray-300', 'border-gray-600');
                    btn.classList.add('active', 'bg-white', 'text-brand-dark', 'border-white');

                    // Filter Logic
                    activeFilter = btn.dataset.filter;
                    renderEvents();
                });
            });

            // Toggle Past Events
            togglePastBtn.addEventListener('click', () => {
                pastEventsWrapper.classList.toggle('hidden');
                const isHidden = pastEventsWrapper.classList.contains('hidden');
                togglePastBtn.innerHTML = isHidden
                    ? '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> View Past Events'
                    : '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg> Hide Past Events';
            });

            // Reset Filter from No Events Message
            document.getElementById('reset-filters').addEventListener('click', () => {
                const allBtn = document.querySelector('[data-filter="all"]');
                if(allBtn) allBtn.click();
            });

            // Init
            loadEvents();
        });
    </script>
</body>
</html>